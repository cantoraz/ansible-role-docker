---

# - name: Ensure that hostname is configured
#   hostname:
#     name: "{{ inventory_hostname }}"

- name: Disable default APT repository
  replace:
    path: /etc/apt/sources.list
    regexp: '^(deb(?:-src)? .*)$'
    replace: '#\1'

- name: Add Aliyun APT repository mirror
  apt_repository:
    repo: deb https://mirrors.aliyun.com/ubuntu/ {{ item }} main restricted universe multiverse
    state: present
    filename: mirrors.aliyun.com
    update_cache: no
  with_items:
    - "{{ ansible_lsb.codename }}-security"
    - "{{ ansible_lsb.codename }}"
    - "{{ ansible_lsb.codename }}-updates"
    # - "{{ ansible_lsb.codename }}-proposed"
    # - "{{ ansible_lsb.codename }}-backports"
  notify: update apt cache

- meta: flush_handlers
